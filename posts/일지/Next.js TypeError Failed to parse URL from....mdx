---
title: Next.js TypeError Failed to parse URL from...
description: next ì‚¬ìš© ì¤‘ ë°œìƒí•œ ì—ëŸ¬ì— ëŒ€í•´ ê¸°ìˆ í•œë‹¤.
tags:
  - next
  - bugs
createdAt: 2025-10-29
thumbnail: /thumbnails/bugs.webp
draft: false
---
## ì„œë¡ 

nextë¥¼ í†µí•´ì„œ ê°œë°œí•˜ë˜ ë„ì¤‘ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸êµ¬ë¥¼ ë§Œë‚˜ê²Œ ëë‹¤.

```bash
TypeError: Failed to parse URL from api/users/search?...
```
nextì˜ `Route Handler`ë¥¼ í†µí•´ apië¥¼ í˜¸ì¶œí•˜ë˜ ë„ì¤‘ ìƒê¸´ ë¬¸ì œì´ë‹¤. ë‚˜ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¡œ apië¥¼ í˜¸ì¶œí•˜ê³  ìˆì—ˆë‹¤.

```tsx
// api/lib/api.ts

export async function apiGet<T>(url: string): Promise<T> {
Â  const res = await fetch(url);
Â  if (!res.ok) throw new Error(`API ERROR : ${res.status}`);
Â  return res.json();
}

export const API = {
Â  async searchUser(username: string) {
Â  Â  return apiGet<UserResponse>(
Â  Â  Â  `/api/users/search?username=${username}`
Â  Â  );
Â  },
};
...

// page.tsx
...
	const resp = await API.searchUser(username); // error
	
```
`lib/api.ts`ì—ì„œ API wrapperì™€ API ê°ì²´ë¥¼ exportí•˜ê³  pageì—ì„œ ì´ë¥¼ ì‚¬ìš©í•˜ëŠ” ì‹ì´ì—ˆë‹¤. ë‹¹ì—°íˆ `api/users/search/route.ts`ì—ì„œ í•´ë‹¹ apië¥¼ ì •ì˜í•˜ê³  ìˆì—ˆë‹¤. 

ê·¸ë¦¬ê³  ì´ ì—ëŸ¬ì˜ ê°€ì¥ í° ë¬¸ì œê°€ ìˆì—ˆëŠ”ë°....

ì´ê²ƒì´ **ê¸°ì¡´ì—ëŠ” ì˜ ë™ì‘í•˜ë˜ ì½”ë“œ**ì˜€ë‹¤ëŠ” ì ì´ë‹¤.

---
## ê¸°ì¡´ ë°©ì‹

ë¬´ì—‡ì´ ë‹¬ë¼ì§„ ê±¸ê¹Œ?  
ì´ì „ì˜ `page.tsx`ëŠ” **í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸**ì˜€ë‹¤.

```tsx
// page.tsx
...
	useEffect(()=>{
		const getUser = async()=>{
			const resp = await API.searchUser(username);
			...
			};
		getUser();
		}
	},[])
```
ìœ„ ì½”ë“œê°€ ì²˜ìŒì— APIë¥¼ í˜¸ì¶œí•˜ë˜ ë°©ì‹ì´ì—ˆë‹¤. í•˜ì§€ë§Œ `page`ë¥¼ **ì„œë²„ ì»´í¬ë„ŒíŠ¸**ë¡œ ë°”ê¾¸ë©´ì„œ ì—ëŸ¬ê°€ ë°œìƒí•œ ê²ƒì´ë‹¤. 
ì¦‰, ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤í–‰ë˜ëŠ” í´ë¼ì´ì–¸íŠ¸ í™˜ê²½ì—ì„œ `fetch('/api/users/...')`ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í–ˆë˜ ê²ƒì´ë‹¤.  
ì´ ê²½ìš° `window.location.origin`ì´ ì•”ë¬µì ìœ¼ë¡œ ì¡´ì¬í•˜ë¯€ë¡œ ìƒëŒ€ ê²½ë¡œ(`'/api/...'`) ìš”ì²­ì´ ë¬¸ì œì—†ì´ ë™ì‘í•œë‹¤.

## ì‹ ê·œ ë°©ì‹

```tsx
export default async function Page({
Â  params,
}: {
Â  params: { username: string };
}){
	const { username } = await params;
	const resp = await API.searchUser(username); // error
}
```
`page.tsx`ë¥¼ **ì„œë²„ ì»´í¬ë„ŒíŠ¸(Server Component)** ë¡œ ë³€ê²½í•œ ë’¤ ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤.
ì¦‰, **ë™ì¼í•œ API í˜¸ì¶œ ì½”ë“œ**ê°€ ì„œë²„ í™˜ê²½ì—ì„œëŠ” ë™ì‘í•˜ì§€ ì•Šì•˜ë‹¤.

---
## ë¶„ì„

ì²˜ìŒì—ëŠ” ì›ì¸ì„ ì°¾ê¸° ì–´ë ¤ì› ë‹¤.  
í•˜ì§€ë§Œ ê²°ë¡ ì€ ë‹¨ìˆœí–ˆë‹¤.

>ì„œë²„ ì»´í¬ë„ŒíŠ¸ëŠ” ì„œë²„ í™˜ê²½ì—ì„œ ë™ì‘í•œë‹¤.

ì¦‰, **ë¸Œë¼ìš°ì € í™˜ê²½ì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ìƒëŒ€ ê²½ë¡œ(`'/api/users/search?...'`)ë¥¼ fetchí•  ìˆ˜ ì—†ë‹¤.**

ì„œë²„ì—ì„œ `fetch('/api/...')`ë¥¼ í˜¸ì¶œí•˜ë©´ Node.js ëŸ°íƒ€ì„ì€ ê·¸ ê²½ë¡œë¥¼ **ì ˆëŒ€ URLë¡œ í•´ì„í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì—**  
`TypeError: Failed to parse URL`ì´ ë°œìƒí•œë‹¤.  
Nodeì˜ `fetch`ëŠ” í•­ìƒ ì™„ì „í•œ URL(`https://...`) í˜•íƒœë¥¼ ìš”êµ¬í•˜ê¸° ë•Œë¬¸ì´ë‹¤.
## React Server Component

React Server Component(RSC)ëŠ” ì„œë²„ì—ì„œ ë Œë”ë§ë˜ëŠ” ì»´í¬ë„ŒíŠ¸ë‹¤.  
ë”°ë¼ì„œ ì„œë²„ í™˜ê²½ì—ì„œ ê°€ëŠ¥í•œ ì¼ê³¼ ë¶ˆê°€ëŠ¥í•œ ì¼ì´ ëª…í™•íˆ êµ¬ë¶„ëœë‹¤.

---

### âœ… ì•Œ ìˆ˜ ìˆëŠ” ê²ƒ

ì„œë²„ì—ì„œ ì‹¤í–‰ë˜ê¸°ì—, Node.js ëŸ°íƒ€ì„ ìˆ˜ì¤€ì˜ ì •ë³´ì™€ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼ ê°€ëŠ¥í•˜ë‹¤.

1. **í™˜ê²½ ë³€ìˆ˜**
    - `process.env` ì ‘ê·¼ ê°€ëŠ¥.
2. **íŒŒì¼ ì‹œìŠ¤í…œ**
    - `fs` ëª¨ë“ˆë¡œ ì„œë²„ ë¡œì»¬ íŒŒì¼ ì½ê¸° ê°€ëŠ¥.
3. **ì„œë²„ ë¡œì§**
    - ì¸ì¦, ë°ì´í„° ì „ì²˜ë¦¬, ìºì‹± ë“± ê°€ëŠ¥.
4. **ë°ì´í„°ë² ì´ìŠ¤ / ì™¸ë¶€ API**
    - DB ì¿¼ë¦¬ë‚˜ ì›ê²© API í˜¸ì¶œ ê°€ëŠ¥.
5. **ìš”ì²­ ì»¨í…ìŠ¤íŠ¸ (Next.js í•œì •)**
    - `headers()`, `cookies()`ë¡œ ìš”ì²­ í—¤ë”Â·ì¿ í‚¤ ì ‘ê·¼ ê°€ëŠ¥.

### ğŸš« ì•Œ ìˆ˜ ì—†ëŠ” ê²ƒ

ì„œë²„ì—ì„œëŠ” ë¸Œë¼ìš°ì € ëŸ°íƒ€ì„ì— ì¡´ì¬í•˜ëŠ” ì •ë³´ë‚˜ ì»¨í…ìŠ¤íŠ¸ì— ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤.

1. **í´ë¼ì´ì–¸íŠ¸ ëŸ°íƒ€ì„ ê°ì²´**
    - `window`, `document`, `localStorage` ë“± ë¶ˆê°€.
2. **ìƒëŒ€ ê²½ë¡œ fetch**
    - ë¸Œë¼ìš°ì €ì˜ `origin` ê°œë…ì´ ì—†ìœ¼ë¯€ë¡œ `fetch('/api/...')` ë¶ˆê°€.
3. **í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ**
    - ì…ë ¥ê°’, ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ë“± ë¸Œë¼ìš°ì € ì´ë²¤íŠ¸ ê¸°ë°˜ ìƒíƒœëŠ” ì•Œ ìˆ˜ ì—†ìŒ.
4. **ì •ì  ë¹Œë“œ ì‹œ ìš”ì²­ ì •ë³´**
    - SSG í˜ì´ì§€ì—ì„œëŠ” `headers()`Â·`cookies()` ì ‘ê·¼ ë¶ˆê°€.

---
## ê²°ë¡ 

`page.tsx`ê°€ **Server Componentë¡œ ì „í™˜**ë˜ë©´ì„œ,  
Node.js í™˜ê²½ì—ì„œ `fetch('/api/...')` ìš”ì²­ì´ ë” ì´ìƒ ìœ íš¨í•˜ì§€ ì•Šê²Œ ë˜ì—ˆë‹¤.

ì„œë²„ëŠ” `host`ë‚˜ `origin`ì„ ì•”ë¬µì ìœ¼ë¡œ ì•Œ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì—, ìƒëŒ€ ê²½ë¡œë¥¼ ì ˆëŒ€ URLë¡œ ë³€í™˜í•˜ì§€ ëª»í•˜ê³  ì—ëŸ¬ë¥¼ ë˜ì§„ë‹¤.

---

## í•´ê²°

ê°€ì¥ ë‹¨ìˆœí•œ í•´ê²°ì±…ì€ **baseURLì„ ëª…ì‹œí•˜ëŠ” ê²ƒ**ì´ë‹¤.
```typescript
export async function apiGet<T>(url: string): Promise<T> {
Â  const API_BASE_URL = process.env.API_BASE_URL; // ì¶”ê°€
Â  const res = await fetch(API_BASE_URL + url);
Â  if (!res.ok) throw new Error(`API ERROR : ${res.status}`);
Â  
Â  return res.json();
}
```
í˜¹ì€ Next.jsì˜ `headers()`ë¥¼ ì´ìš©í•´ **ìš”ì²­ ì‹œì ì˜ Hostë¥¼ ë™ì ìœ¼ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ë„ ìˆë‹¤.**

```typescript
import { headers } from "next/headers";  

export async function apiGet<T>(url: string): Promise<T> {   
	const host = headers().get("host");   
	const protocol = process.env.NODE_ENV === "development" ? "http" : "https"; 
	const res = await fetch(`${protocol}://${host}${url}`);   
	if (!res.ok) throw new Error(`API ERROR : ${res.status}`);   
	return res.json(); 
}
```

ì´ë ‡ê²Œ í•˜ë©´ ì„œë²„ ë Œë”ë§ ì¤‘ì—ë„ ì •í™•í•œ ì ˆëŒ€ URLë¡œ APIë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤.

---

## ìš”ì•½

- React Server ComponentëŠ” **Node.js ì„œë²„ í™˜ê²½ì—ì„œ ì‹¤í–‰**ëœë‹¤.
- ë¸Œë¼ìš°ì € ì»¨í…ìŠ¤íŠ¸(`window`, `host`, `localStorage`)ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤.
- Next.jsì—ì„œëŠ” `headers()`ì™€ `cookies()`ë¥¼ í†µí•´ ìš”ì²­ ì •ë³´ë¥¼ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
- API í˜¸ì¶œ ì‹œì—ëŠ” **ì ˆëŒ€ URLì„ ì§€ì •í•˜ê±°ë‚˜**, **ìš”ì²­ ì»¨í…ìŠ¤íŠ¸ì—ì„œ hostë¥¼ ì¶”ì¶œ**í•´ì•¼ í•œë‹¤.

---
## ì°¸ê³  ìë£Œ


[# Next.js 13 ì—ëŸ¬ ì‚½ì§ˆê¸° - TypeError: Failed to parse URL from](https://jgjgill-blog.netlify.app/road/2023-12-28/)
[# Next.js ê³µì‹ë¬¸ì„œ](https://nextjs.org/docs/app/getting-started/server-and-client-components)
[# Reactì˜ RSC, RCCì— ëŒ€í•˜ì—¬](https://funveloper.tistory.com/214)
